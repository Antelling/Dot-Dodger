(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))e(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const n of o.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&e(n)}).observe(document,{childList:!0,subtree:!0});function i(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function e(s){if(s.ep)return;s.ep=!0;const o=i(s);fetch(s.href,o)}})();var D=(l=>(l.MENU="MENU",l.PLAYING="PLAYING",l.GAME_OVER="GAME_OVER",l.PAUSED="PAUSED",l))(D||{}),E=(l=>(l.SPAWNING="SPAWNING",l.ACTIVE="ACTIVE",l.FROZEN="FROZEN",l.DEAD="DEAD",l))(E||{}),y=(l=>(l.ZOMBIE_SNOW="ZOMBIE_SNOW",l.SWEEPER_LINE="SWEEPER_LINE",l.SPARSE_GRID="SPARSE_GRID",l.BOUNCING_BALL="BOUNCING_BALL",l.GATLING_POINT="GATLING_POINT",l.BULLET_HELL="BULLET_HELL",l.CONTAINMENT_RING="CONTAINMENT_RING",l.CYCLONE="CYCLONE",l))(y||{}),g=(l=>(l.KINETIC_BOMB="KINETIC_BOMB",l.BLASTER="BLASTER",l.ICE_BOMB="ICE_BOMB",l.HOMING_MISSILE="HOMING_MISSILE",l.NUCLEAR_BOMB="NUCLEAR_BOMB",l.ELECTRIC_BOMB="ELECTRIC_BOMB",l.DOT_REPELLENT="DOT_REPELLENT",l.CHAINSAW="CHAINSAW",l.FLAME_BURST="FLAME_BURST",l))(g||{}),d=(l=>(l.EASY="EASY",l.MEDIUM="MEDIUM",l.HARD="HARD",l))(d||{});class v{canvas;ctx;width=0;height=0;dpr=1;circleBatches=new Map;outlineBatches=new Map;static TWO_PI=Math.PI*2;static SCALE=1.3;constructor(t="game"){const i=document.getElementById(t);if(!i)throw new Error(`Canvas element with id "${t}" not found`);this.canvas=i;const e=i.getContext("2d");if(!e)throw new Error("Failed to get 2D context");this.ctx=e,this.resize(),window.addEventListener("resize",()=>this.resize())}resize(){this.dpr=window.devicePixelRatio||1,this.width=window.innerWidth,this.height=window.innerHeight,this.canvas.width=Math.floor(this.width*this.dpr),this.canvas.height=Math.floor(this.height*this.dpr),this.canvas.style.width=`${this.width}px`,this.canvas.style.height=`${this.height}px`}getBounds(){return{width:this.width/v.SCALE,height:this.height/v.SCALE}}clear(t="#000000"){this.ctx.fillStyle=t,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.save(),this.ctx.scale(this.dpr*v.SCALE,this.dpr*v.SCALE)}endFrame(){this.ctx.restore()}drawCircle(t,i,e,s){let o=this.circleBatches.get(s);o||(o=[],this.circleBatches.set(s,o)),o.push({x:t,y:i,radius:e})}drawCircleOutline(t,i,e,s,o=2){let n=this.outlineBatches.get(s);n||(n=[],this.outlineBatches.set(s,n)),n.push({x:t,y:i,radius:e,lineWidth:o})}flushBatches(){const t=this.ctx;t.fillStyle="",this.circleBatches.forEach((i,e)=>{t.fillStyle=e,t.beginPath();for(let s=0;s<i.length;s++){const o=i[s];t.moveTo(o.x+o.radius,o.y),t.arc(o.x,o.y,o.radius,0,v.TWO_PI)}t.fill()}),this.circleBatches.clear(),t.strokeStyle="",this.outlineBatches.forEach((i,e)=>{const s=new Map;for(let o=0;o<i.length;o++){const n=i[o];let a=s.get(n.lineWidth);a||(a=[],s.set(n.lineWidth,a)),a.push(n)}s.forEach((o,n)=>{t.strokeStyle=e,t.lineWidth=n,t.beginPath();for(let a=0;a<o.length;a++){const r=o[a];t.moveTo(r.x+r.radius,r.y),t.arc(r.x,r.y,r.radius,0,v.TWO_PI)}t.stroke()})}),this.outlineBatches.clear()}drawCircleImmediate(t,i,e,s){this.ctx.fillStyle=s,this.ctx.beginPath(),this.ctx.arc(t,i,e,0,v.TWO_PI),this.ctx.fill()}drawLine(t,i,e,s,o,n=2){this.ctx.beginPath(),this.ctx.moveTo(t,i),this.ctx.lineTo(e,s),this.ctx.strokeStyle=o,this.ctx.lineWidth=n,this.ctx.stroke()}drawArrow(t,i,e,s,o="#00CC00"){const n=Math.cos(e),a=Math.sin(e),r=t+n*s,h=i+a*s,c=this.ctx;c.strokeStyle=o,c.lineWidth=3,c.beginPath(),c.moveTo(t,i),c.lineTo(r,h),c.stroke();const p=8,u=Math.PI/6;c.beginPath(),c.moveTo(r,h),c.lineTo(r-p*Math.cos(e-u),h-p*Math.sin(e-u)),c.moveTo(r,h),c.lineTo(r-p*Math.cos(e+u),h-p*Math.sin(e+u)),c.stroke()}drawRect(t,i,e,s,o){this.ctx.fillStyle=o,this.ctx.fillRect(t,i,e,s)}drawText(t,i,e,s="#FFFFFF",o=16){this.ctx.font=`${o}px Arial`,this.ctx.fillStyle=s,this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText(t,i,e)}drawTextLeft(t,i,e,s="#FFFFFF",o=16){this.ctx.font=`${o}px Arial`,this.ctx.fillStyle=s,this.ctx.textAlign="left",this.ctx.textBaseline="top",this.ctx.fillText(t,i,e)}drawPolygon(t,i){if(t.length<3)return;const e=this.ctx;e.fillStyle=i,e.beginPath(),e.moveTo(t[0].x,t[0].y);for(let s=1;s<t.length;s++)e.lineTo(t[s].x,t[s].y);e.closePath(),e.fill()}getContext(){return this.ctx}}const B=10,J=B*.5,W=800,Q=15,w=8,V=1e3,k=1.5,L=20,tt="#00FF00",it="#00CC00",et="#FF0000",st="#FF6666",ot="#00FFFF",nt="#000000",$={KINETIC_BOMB:"#FF6600",BLASTER:"#9900FF",ICE_BOMB:"#00CCFF",HOMING_MISSILE:"#FFFF00",NUCLEAR_BOMB:"#FF0000",ELECTRIC_BOMB:"#00FFFF",DOT_REPELLENT:"#808080",CHAINSAW:"#0066FF",FLAME_BURST:"#FF9900"},at=60,G=1e3/at;class rt{velocity={x:0,y:0};permissionState="unknown";tiltBasis=null;constructor(){this.checkPermissionAvailability(),this.trackScreenOrientation()}trackScreenOrientation(){window.addEventListener("orientationchange",()=>{})}setTiltBasis(t){this.tiltBasis=t}getCurrentTiltBasis(){return this.tiltBasis}checkPermissionAvailability(){typeof DeviceOrientationEvent.requestPermission=="function"?this.permissionState="pending":window.DeviceOrientationEvent?(this.permissionState="granted",this.enableDeviceOrientation()):this.permissionState="denied"}async requestPermission(){if(this.permissionState==="granted")return!0;if(typeof DeviceOrientationEvent.requestPermission=="function")try{return await DeviceOrientationEvent.requestPermission()==="granted"?(this.permissionState="granted",this.enableDeviceOrientation(),!0):(this.permissionState="denied",!1)}catch(t){return console.error("Device orientation permission error:",t),this.permissionState="denied",!1}return this.permissionState==="granted"}enableDeviceOrientation(){window.addEventListener("deviceorientation",this.handleOrientation.bind(this))}lastTilt={gamma:0,beta:45};calibrateTiltBasis(){this.tiltBasis={...this.lastTilt}}getScreenOrientation(){return screen.orientation?screen.orientation.angle:0}transformTiltToGameCoords(t,i,e){const s=t,o=i-45;switch(e){case 0:return{x:s,y:o};case 90:case-270:return{x:-o,y:s};case 180:case-180:return{x:-s,y:-o};case-90:case 270:return{x:o,y:-s};default:return{x:s,y:o}}}handleOrientation(t){if(t.gamma===null||t.beta===null)return;const i=t.gamma,e=t.beta;this.lastTilt={gamma:i,beta:e};const s=this.getScreenOrientation(),o=this.tiltBasis;let n=i,a=e-45;o!==null&&(n=i-o.gamma,a=e-45-(o.beta-45));const r=this.transformTiltToGameCoords(n,a+45,s),h=this.clamp(r.x/22.5,-1,1),c=this.clamp(r.y/22.5,-1,1);this.velocity.x=h*W,this.velocity.y=c*W}clamp(t,i,e){return Math.max(i,Math.min(e,t))}getVelocity(){return{x:this.velocity.x,y:this.velocity.y}}getPermissionState(){return this.permissionState}needsPermissionRequest(){return this.permissionState==="pending"}destroy(){window.removeEventListener("deviceorientation",this.handleOrientation.bind(this))}}class I{constructor(t=0,i=0){this.x=t,this.y=i}static from(t){return new I(t.x,t.y)}add(t){return new I(this.x+t.x,this.y+t.y)}subtract(t){return new I(this.x-t.x,this.y-t.y)}multiply(t){return new I(this.x*t,this.y*t)}divide(t){if(t===0)throw new Error("Division by zero");return new I(this.x/t,this.y/t)}magnitude(){return Math.sqrt(this.x*this.x+this.y*this.y)}normalize(){const t=this.magnitude();return t===0?new I(0,0):this.divide(t)}dot(t){return this.x*t.x+this.y*t.y}angle(){return Math.atan2(this.y,this.x)}angleTo(t){return Math.atan2(t.y-this.y,t.x-this.x)}clone(){return new I(this.x,this.y)}set(t,i){this.x=t,this.y=i}addInPlace(t){this.x+=t.x,this.y+=t.y}}function U(l,t){const i=t.x-l.x,e=t.y-l.y;return Math.sqrt(i*i+e*e)}function K(l,t){if(t.width>0&&t.height>0){for(;l.x<0;)l.x+=t.width;for(;l.y<0;)l.y+=t.height;l.x=l.x%t.width,l.y=l.y%t.height}}function z(l,t,i,e){const s=i.x-l.x,o=i.y-l.y,n=s*s+o*o,a=t+e;return n<a*a}function q(l,t=0){return{x:t+Math.random()*(l.width-t*2),y:t+Math.random()*(l.height-t*2)}}class ht{position;velocity={x:0,y:0};directionAngle=0;hitboxRadius=J;constructor(t,i){this.position=new I(t,i)}update(t,i,e,s=!0){this.velocity.x=i.x,this.velocity.y=i.y,(this.velocity.x!==0||this.velocity.y!==0)&&(this.directionAngle=Math.atan2(this.velocity.y,this.velocity.x)),this.position.x+=this.velocity.x*t,this.position.y+=this.velocity.y*t,s?K(this.position,e):(this.position.x=Math.max(0,Math.min(e.width,this.position.x)),this.position.y=Math.max(0,Math.min(e.height,this.position.y)))}setPosition(t,i){this.position.x=t,this.position.y=i}render(t){t.drawCircleImmediate(this.position.x,this.position.y,B,tt);const i=this.position.x+Math.cos(this.directionAngle)*(B+2),e=this.position.y+Math.sin(this.directionAngle)*(B+2);t.drawArrow(i,e,this.directionAngle,Q,it)}getPosition(){return this.position}}class lt{score=0;kills=0;startTime=0;start(){this.score=0,this.kills=0,this.startTime=Date.now()}addKill(){this.kills++}addKills(t){this.kills+=t}addPatternBonus(t){const i={EASY:50,MEDIUM:100,HARD:200};this.score+=i[t]||50}getScore(){const t=Math.floor((Date.now()-this.startTime)/1e4);return this.score+this.kills*10+t}getKills(){return this.kills}getTimeAlive(){return Date.now()-this.startTime}}const F=100,ct=[[-1,-1],[0,-1],[1,-1],[-1,0],[0,0],[1,0],[-1,1],[0,1],[1,1]];class dt{grid=new Map;nearbyKeys=new Array(9);constructor(t){}getCellKey(t,i){const e=Math.floor(t/F),s=Math.floor(i/F);return e*1e4+s}getNearbyKeys(t,i){const e=Math.floor(t/F),s=Math.floor(i/F);for(let o=0;o<9;o++){const[n,a]=ct[o];this.nearbyKeys[o]=(e+n)*1e4+(s+a)}return this.nearbyKeys}rebuildGrid(t){this.grid.clear();for(let i=0;i<t.length;i++){const e=t[i];if(!e.isLethal()&&!e.isFrozen())continue;const s=e.getPosition(),o=this.getCellKey(s.x,s.y);let n=this.grid.get(o);n||(n=[],this.grid.set(o,n)),n.push(e)}}checkPlayerDotCollision(t){const i=t.getPosition(),e=t.hitboxRadius,s=this.getNearbyKeys(i.x,i.y);for(let o=0;o<9;o++){const n=this.grid.get(s[o]);if(n)for(let a=0;a<n.length;a++){const r=n[a],h=r.getPosition(),c=r.getEffectiveRadius();if(z(i,e,h,c))return r}}return null}checkPlayerOrbCollision(t,i){const e=t.getPosition(),s=t.hitboxRadius;for(let o=0;o<i.length;o++){const n=i[o];if(!n.isActive())continue;const a=n.getPosition(),r=n.radius;if(z(e,s,a,r))return n}return null}updateBounds(t){}}class pt{currentDifficulty=d.EASY;mediumThreshold=500;hardThreshold=1500;update(t){t>=this.hardThreshold?this.currentDifficulty=d.HARD:t>=this.mediumThreshold?this.currentDifficulty=d.MEDIUM:this.currentDifficulty=d.EASY}getDifficulty(){return this.currentDifficulty}getSpawnRateMultiplier(){return{[d.EASY]:1,[d.MEDIUM]:1.5,[d.HARD]:2}[this.currentDifficulty]}getMaxDots(){return{[d.EASY]:150,[d.MEDIUM]:225,[d.HARD]:300}[this.currentDifficulty]}}class ut{patterns=new Map;register(t,i){this.patterns.set(t,i)}create(t){const i=this.patterns.get(t);return i?new i:null}getAvailableTypes(){return Array.from(this.patterns.keys())}}const x=new ut;class ft{toasts=[];allMessages=[];container;errorOverlay=null;nextId=0;maxToasts=5;defaultDuration=3e3;constructor(){this.container=document.createElement("div"),this.container.id="toast-container",this.container.style.cssText=`
      position: fixed;
      bottom: 20px;
      right: 20px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      z-index: 1000;
      pointer-events: none;
      font-family: Arial, sans-serif;
    `,document.body.appendChild(this.container)}show(t,i="info",e){const s={id:this.nextId++,text:t,type:i,createdAt:Date.now(),duration:e??this.defaultDuration};if(this.toasts.push(s),this.allMessages.push(s),this.allMessages.length>100&&(this.allMessages=this.allMessages.slice(-50)),this.toasts.length>this.maxToasts){const o=this.toasts.shift();o&&this.removeToastElement(o.id)}this.renderToast(s),this.scheduleRemoval(s)}renderToast(t){const i=document.createElement("div");i.id=`toast-${t.id}`;const e=this.getColorsForType(t.type);i.style.cssText=`
      background: ${e.background};
      color: ${e.text};
      padding: 10px 16px;
      border-radius: 4px;
      font-size: 14px;
      max-width: 280px;
      word-wrap: break-word;
      opacity: 0;
      transform: translateX(20px);
      transition: opacity 0.3s ease, transform 0.3s ease;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
      border-left: 3px solid ${e.border};
    `,i.textContent=t.text,this.container.appendChild(i),requestAnimationFrame(()=>{i.style.opacity="1",i.style.transform="translateX(0)"})}getColorsForType(t){switch(t){case"success":return{background:"rgba(0, 100, 0, 0.9)",text:"#90EE90",border:"#00FF00"};case"warning":return{background:"rgba(100, 80, 0, 0.9)",text:"#FFE4B5",border:"#FFD700"};case"error":return{background:"rgba(100, 0, 0, 0.9)",text:"#FFB6C1",border:"#FF4444"};default:return{background:"rgba(30, 30, 30, 0.9)",text:"#E0E0E0",border:"#888888"}}}scheduleRemoval(t){setTimeout(()=>{this.removeToast(t.id)},t.duration)}removeToast(t){const i=this.toasts.findIndex(e=>e.id===t);i!==-1&&(this.toasts.splice(i,1),this.removeToastElement(t))}removeToastElement(t){const i=document.getElementById(`toast-${t}`);i&&(i.style.opacity="0",i.style.transform="translateX(20px)",setTimeout(()=>{i.remove()},300))}clear(){this.toasts.forEach(t=>{this.removeToastElement(t.id)}),this.toasts=[],this.allMessages=[]}getRecentMessages(t=5){return this.toasts.slice(-t)}getAllMessages(){return this.allMessages}setupGlobalErrorHandler(){window.addEventListener("error",t=>{const i=t.error?.stack??"No stack trace available";this.showFatalError("Runtime Error",t.message,i,t.filename,t.lineno,t.colno)}),window.addEventListener("unhandledrejection",t=>{const i=t.reason,e=i instanceof Error?i.message:String(i),s=i instanceof Error?i.stack??"No stack trace available":"No stack trace available";this.showFatalError("Unhandled Promise Rejection",e,s)})}showFatalError(t,i,e,s,o,n){if(this.errorOverlay)return;this.errorOverlay=document.createElement("div"),this.errorOverlay.id="fatal-error-overlay",this.errorOverlay.style.cssText=`
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0, 0, 0, 0.95);
      z-index: 9999;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      padding: 40px;
      box-sizing: border-box;
      font-family: 'Courier New', monospace;
      overflow-y: auto;
    `;const a=document.createElement("div");a.style.cssText=`
      max-width: 900px;
      width: 100%;
      background: #1a1a1a;
      border: 2px solid #ff4444;
      border-radius: 8px;
      padding: 30px;
      box-shadow: 0 0 30px rgba(255, 68, 68, 0.3);
    `;const r=document.createElement("h1");r.textContent="âš ï¸ "+t,r.style.cssText=`
      color: #ff4444;
      margin: 0 0 20px 0;
      font-size: 24px;
      font-family: Arial, sans-serif;
    `;const h=document.createElement("div");if(h.textContent=i,h.style.cssText=`
      color: #ffffff;
      font-size: 16px;
      margin-bottom: 10px;
      padding: 10px;
      background: rgba(255, 68, 68, 0.1);
      border-radius: 4px;
      font-family: Arial, sans-serif;
    `,a.appendChild(r),a.appendChild(h),s){const P=document.createElement("div");P.textContent=`Location: ${s}:${o??"?"}:${n??"?"}`,P.style.cssText=`
        color: #aaaaaa;
        font-size: 12px;
        margin-bottom: 20px;
        font-family: Arial, sans-serif;
      `,a.appendChild(P)}const c=document.createElement("div");c.textContent="Stack Trace:",c.style.cssText=`
      color: #ff8844;
      font-size: 14px;
      margin: 20px 0 10px 0;
      font-weight: bold;
      font-family: Arial, sans-serif;
    `,a.appendChild(c);const p=document.createElement("pre");p.textContent=e,p.style.cssText=`
      color: #cccccc;
      font-size: 12px;
      line-height: 1.5;
      background: #0a0a0a;
      padding: 15px;
      border-radius: 4px;
      overflow-x: auto;
      white-space: pre-wrap;
      word-wrap: break-word;
      max-height: 400px;
      overflow-y: auto;
      border: 1px solid #333;
      margin: 0;
    `,a.appendChild(p);const u=document.createElement("div");u.style.cssText=`
      display: flex;
      gap: 10px;
      margin-top: 20px;
    `;const f=document.createElement("button");f.textContent="ðŸ”„ Reload Game",f.style.cssText=`
      padding: 12px 24px;
      font-size: 14px;
      background: #ff4444;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-family: Arial, sans-serif;
      font-weight: bold;
    `,f.onmouseover=()=>f.style.background="#ff6666",f.onmouseout=()=>f.style.background="#ff4444",f.onclick=()=>window.location.reload();const m=document.createElement("button");m.textContent="ðŸ“‹ Copy Error",m.style.cssText=`
      padding: 12px 24px;
      font-size: 14px;
      background: #444444;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-family: Arial, sans-serif;
      font-weight: bold;
    `,m.onmouseover=()=>m.style.background="#555555",m.onmouseout=()=>m.style.background="#444444",m.onclick=()=>{const P=`${t}
${i}
${s?`Location: ${s}:${o}:${n}
`:""}
Stack Trace:
${e}`;navigator.clipboard.writeText(P).then(()=>{m.textContent="âœ… Copied!",setTimeout(()=>m.textContent="ðŸ“‹ Copy Error",2e3)})},u.appendChild(f),u.appendChild(m),a.appendChild(u),this.errorOverlay.appendChild(a),document.body.appendChild(this.errorOverlay),console.error(`[FATAL ERROR] ${t}:`,i,`
Stack:`,e)}}const R=new ft,gt=new Map([[y.ZOMBIE_SNOW,d.EASY],[y.SPARSE_GRID,d.EASY],[y.CONTAINMENT_RING,d.EASY],[y.SWEEPER_LINE,d.MEDIUM],[y.GATLING_POINT,d.MEDIUM],[y.BOUNCING_BALL,d.MEDIUM],[y.BULLET_HELL,d.HARD],[y.CYCLONE,d.HARD]]),_={EASY_MAX:500,MEDIUM_MAX:1500};class mt{activePatterns=[];patternTimer=0;nextPatternInterval=3e3;currentScore=0;allDotsCache=[];minInterval=2e3;maxInterval=4e3;constructor(){this.nextPatternInterval=this.getRandomInterval()}update(t,i,e){if(this.patternTimer+=t*1e3,this.patternTimer>=this.nextPatternInterval){this.patternTimer=0,this.nextPatternInterval=this.getRandomInterval();const s=this.selectNextPattern();s&&this.spawnPattern(s,i,e)}for(let s=0;s<this.activePatterns.length;s++){const o=this.activePatterns[s];o.tick(t),o.update(t,i,e)}this.removeCompletedPatterns(),this.rebuildDotsCache()}addPattern(t){this.isPatternTypeActive(t.type)||this.activePatterns.push(t)}removePattern(t){const i=this.activePatterns.indexOf(t);i!==-1&&(t.clear(),this.activePatterns.splice(i,1))}getActivePatterns(){return this.activePatterns}getAllDots(){return this.allDotsCache}rebuildDotsCache(){this.allDotsCache.length=0;for(let t=0;t<this.activePatterns.length;t++){const i=this.activePatterns[t].getDots();for(let e=0;e<i.length;e++)this.allDotsCache.push(i[e])}}setScore(t){this.currentScore=t}getAvailablePatternTypes(){const t=[],i=x.getAvailableTypes();for(const e of i){const s=gt.get(e);s&&this.isDifficultyAvailable(s)&&t.push(e)}return t}selectNextPattern(){const i=this.getAvailablePatternTypes().filter(s=>!this.isPatternTypeActive(s));if(i.length===0)return null;const e=Math.floor(Math.random()*i.length);return i[e]}spawnPattern(t,i,e){if(this.isPatternTypeActive(t))return;const s=x.create(t);if(!s){console.warn(`Failed to create pattern of type: ${t}`);return}R.show(`Pattern: ${this.formatPatternName(t)}`,"info"),s.spawn(i,e),s.start(),this.activePatterns.push(s)}isPatternTypeActive(t){for(let i=0;i<this.activePatterns.length;i++)if(this.activePatterns[i].type===t)return!0;return!1}isDifficultyAvailable(t){switch(t){case d.EASY:return this.currentScore<_.EASY_MAX;case d.MEDIUM:return this.currentScore>=_.EASY_MAX&&this.currentScore<_.MEDIUM_MAX;case d.HARD:return this.currentScore>=_.MEDIUM_MAX;default:return!1}}removeCompletedPatterns(){for(let t=this.activePatterns.length-1;t>=0;t--)if(this.activePatterns[t].isComplete()){const i=this.activePatterns[t];i.clear(),this.activePatterns.splice(t,1),R.show(`Pattern ended: ${this.formatPatternName(i.type)}`,"info")}}clear(){for(let t=0;t<this.activePatterns.length;t++)this.activePatterns[t].clear();this.activePatterns=[],this.patternTimer=0,this.allDotsCache.length=0}getPatternTimer(){return this.patternTimer}getPatternInterval(){return this.nextPatternInterval}getRandomInterval(){return this.minInterval+Math.random()*(this.maxInterval-this.minInterval)}formatPatternName(t){return t.toLowerCase().split("_").map(i=>i.charAt(0).toUpperCase()+i.slice(1)).join(" ")}}class N{position;weaponType;pickedUp=!1;radius=L;static BOUNCED_WEAPONS=[g.NUCLEAR_BOMB,g.ELECTRIC_BOMB];velocity={x:0,y:0};lastBounceTime=0;bounceCooldown=100;constructor(t,i,e){this.position={x:t,y:i},this.weaponType=e}render(t){if(this.pickedUp)return;const i=$[this.weaponType]||"#FFFFFF";t.drawCircleImmediate(this.position.x,this.position.y,this.radius,i);const s=N.BOUNCED_WEAPONS.includes(this.weaponType)?"#9B30FF":"#FFFFFF",o=t.getContext();o.strokeStyle=s,o.lineWidth=3,o.beginPath(),o.arc(this.position.x,this.position.y,this.radius+2,0,Math.PI*2),o.stroke(),this.drawIcon(o,this.position.x,this.position.y,this.radius)}drawIcon(t,i,e,s){t.strokeStyle="#FFFFFF",t.lineWidth=2,t.fillStyle="#FFFFFF";const o=s*.5;switch(this.weaponType){case g.KINETIC_BOMB:this.drawKineticBombIcon(t,i,e,o);break;case g.BLASTER:this.drawBlasterIcon(t,i,e,o);break;case g.ICE_BOMB:this.drawIceBombIcon(t,i,e,o);break;case g.HOMING_MISSILE:this.drawHomingMissileIcon(t,i,e,o);break;case g.NUCLEAR_BOMB:this.drawNuclearBombIcon(t,i,e,o);break;case g.ELECTRIC_BOMB:this.drawElectricBombIcon(t,i,e,o);break;case g.DOT_REPELLENT:this.drawDotRepellentIcon(t,i,e,o);break;case g.CHAINSAW:this.drawChainsawIcon(t,i,e,o);break;case g.FLAME_BURST:this.drawFlameBurstIcon(t,i,e,o);break}}drawKineticBombIcon(t,i,e,s){t.beginPath(),t.arc(i,e,s*.3,0,Math.PI*2),t.fill();for(let o=0;o<8;o++){const n=o/8*Math.PI*2;t.beginPath(),t.moveTo(i+Math.cos(n)*s*.4,e+Math.sin(n)*s*.4),t.lineTo(i+Math.cos(n)*s*.8,e+Math.sin(n)*s*.8),t.stroke()}}drawBlasterIcon(t,i,e,s){t.fillRect(i-s*.8,e-s*.15,s*1.6,s*.3),t.fillRect(i-s*.9,e-s*.4,s*.3,s*.8),t.fillRect(i+s*.6,e-s*.4,s*.3,s*.8)}drawIceBombIcon(t,i,e,s){for(let o=0;o<6;o++){const n=o/6*Math.PI*2;t.beginPath(),t.moveTo(i,e),t.lineTo(i+Math.cos(n)*s*.8,e+Math.sin(n)*s*.8),t.stroke();const a=i+Math.cos(n)*s*.5,r=e+Math.sin(n)*s*.5;t.beginPath(),t.moveTo(a,r),t.lineTo(a+Math.cos(n+Math.PI/4)*s*.3,r+Math.sin(n+Math.PI/4)*s*.3),t.moveTo(a,r),t.lineTo(a+Math.cos(n-Math.PI/4)*s*.3,r+Math.sin(n-Math.PI/4)*s*.3),t.stroke()}}drawHomingMissileIcon(t,i,e,s){const o=s*.25,n=s*.35;for(let a=-1;a<=1;a++){const r=i+a*n,h=e;this.drawArrowUp(t,r,h,o)}}drawArrowUp(t,i,e,s){t.beginPath(),t.moveTo(i,e-s),t.lineTo(i-s*.5,e+s*.3),t.lineTo(i+s*.5,e+s*.3),t.closePath(),t.fill()}drawNuclearBombIcon(t,i,e,s){const o=s*.7;t.beginPath(),t.arc(i,e-o*.1,o*.5,0,Math.PI*2),t.fill(),t.fillStyle="#000000",t.beginPath(),t.arc(i-o*.2,e-o*.15,o*.15,0,Math.PI*2),t.fill(),t.beginPath(),t.arc(i+o*.2,e-o*.15,o*.15,0,Math.PI*2),t.fill(),t.beginPath(),t.moveTo(i,e+o*.05),t.lineTo(i-o*.08,e+o*.2),t.lineTo(i+o*.08,e+o*.2),t.closePath(),t.fill(),t.fillStyle="#FFFFFF",t.beginPath(),t.rect(i-o*.25,e+o*.25,o*.5,o*.2),t.fill(),t.strokeStyle="#000000",t.lineWidth=1.5;for(let r=1;r<=2;r++){const h=i-o*.08*r;t.beginPath(),t.moveTo(h,e+o*.25),t.lineTo(h,e+o*.45),t.stroke();const c=i+o*.08*r;t.beginPath(),t.moveTo(c,e+o*.25),t.lineTo(c,e+o*.45),t.stroke()}t.strokeStyle="#FFFFFF",t.lineWidth=3,t.lineCap="round",t.beginPath(),t.moveTo(i-o*.7,e-o*.5),t.lineTo(i+o*.7,e+o*.5),t.stroke(),t.beginPath(),t.moveTo(i+o*.7,e-o*.5),t.lineTo(i-o*.7,e+o*.5),t.stroke(),t.fillStyle="#FFFFFF";const n=o*.1,a=[{x:i-o*.7,y:e-o*.5},{x:i+o*.7,y:e+o*.5},{x:i+o*.7,y:e-o*.5},{x:i-o*.7,y:e+o*.5}];for(const r of a)t.beginPath(),t.arc(r.x,r.y,n,0,Math.PI*2),t.fill()}drawElectricBombIcon(t,i,e,s){t.beginPath(),t.moveTo(i+s*.2,e-s*.8),t.lineTo(i-s*.1,e-s*.1),t.lineTo(i+s*.3,e-s*.1),t.lineTo(i-s*.2,e+s*.8),t.lineTo(i,e+s*.1),t.lineTo(i-s*.3,e+s*.1),t.closePath(),t.fill()}drawDotRepellentIcon(t,i,e,s){t.beginPath(),t.arc(i,e,s*.3,0,Math.PI*2),t.stroke(),t.beginPath(),t.arc(i,e,s*.6,0,Math.PI*2),t.stroke();for(let o=0;o<4;o++){const n=o/4*Math.PI*2;this.drawOutwardArrow(t,i,e,n,s)}}drawOutwardArrow(t,i,e,s,o){const n=i+Math.cos(s)*o*.45,a=e+Math.sin(s)*o*.45,r=o*.2;t.beginPath(),t.moveTo(n+Math.cos(s)*r,a+Math.sin(s)*r),t.lineTo(n+Math.cos(s+2.5)*r,a+Math.sin(s+2.5)*r),t.lineTo(n+Math.cos(s-2.5)*r,a+Math.sin(s-2.5)*r),t.closePath(),t.fill()}drawChainsawIcon(t,i,e,s){t.beginPath(),t.arc(i,e,s*.5,0,Math.PI*2),t.stroke();const o=8;for(let n=0;n<o;n++){const a=n/o*Math.PI*2,r=s*.5,h=s*.7;t.beginPath(),t.moveTo(i+Math.cos(a-.15)*r,e+Math.sin(a-.15)*r),t.lineTo(i+Math.cos(a)*h,e+Math.sin(a)*h),t.lineTo(i+Math.cos(a+.15)*r,e+Math.sin(a+.15)*r),t.fill()}t.beginPath(),t.arc(i,e,s*.15,0,Math.PI*2),t.fill()}drawFlameBurstIcon(t,i,e,s){t.beginPath(),t.moveTo(i,e-s*.8),t.bezierCurveTo(i-s*.4,e-s*.3,i-s*.6,e+s*.2,i-s*.2,e+s*.6),t.quadraticCurveTo(i,e+s*.8,i+s*.2,e+s*.6),t.bezierCurveTo(i+s*.6,e+s*.2,i+s*.4,e-s*.3,i,e-s*.8),t.fill(),t.fillStyle="rgba(0, 0, 0, 0.3)",t.beginPath(),t.moveTo(i,e-s*.4),t.bezierCurveTo(i-s*.2,e,i-s*.3,e+s*.3,i,e+s*.5),t.bezierCurveTo(i+s*.3,e+s*.3,i+s*.2,e,i,e-s*.4),t.fill()}isCollidingWith(t,i){const e=this.position.x-t.x,s=this.position.y-t.y,o=e*e+s*s,n=this.radius+i;return o<n*n}getPosition(){return this.position}getWeaponType(){return this.weaponType}pickup(){this.pickedUp=!0}isActive(){return!this.pickedUp}bounce(t,i){const e=Date.now();if(e-this.lastBounceTime<this.bounceCooldown||(this.lastBounceTime=e,!N.BOUNCED_WEAPONS.includes(this.weaponType)))return!1;const s=this.position.x-i.x,o=this.position.y-i.y,n=Math.sqrt(s*s+o*o);if(n===0)return this.velocity.x=t.x,this.velocity.y=t.y,!0;const a=s/n,r=o/n,h=-r,c=a,p=t.x*a+t.y*r,u=t.x*h+t.y*c,f=.8,m=.6;return this.velocity.x=a*p*f+h*u*m,this.velocity.y=r*p*f+c*u*m,!0}getVelocity(){return this.velocity}updatePosition(t,i){if(!N.BOUNCED_WEAPONS.includes(this.weaponType))return;this.position.x+=this.velocity.x*t,this.position.y+=this.velocity.y*t;const e=this.radius,s=i.width-this.radius,o=this.radius,n=i.height-this.radius;this.position.x<=e?(this.velocity.x=Math.abs(this.velocity.x),this.position.x=e):this.position.x>=s&&(this.velocity.x=-Math.abs(this.velocity.x),this.position.x=s),this.position.y<=o?(this.velocity.y=Math.abs(this.velocity.y),this.position.y=o):this.position.y>=n&&(this.velocity.y=-Math.abs(this.velocity.y),this.position.y=n)}}class yt{orbs=[];orbCount=3;minSpacing=100;playerAvoidRadius=150;initialize(t,i){this.orbs=[];for(let e=0;e<this.orbCount;e++)this.spawnOrb(t,i)}update(t,i){for(;this.orbs.length<this.orbCount;)this.spawnOrb(t,i)}getOrbs(){return this.orbs}removeOrb(t){const i=this.orbs.indexOf(t);i>-1&&this.orbs.splice(i,1)}spawnOrb(t,i){const e=this.getRandomPosition(t,i),s=this.getRandomWeaponType();this.orbs.push(new N(e.x,e.y,s))}getRandomPosition(t,i){let e=0;for(;e<100;){const s=L+Math.random()*(t.width-L*2),o=L+Math.random()*(t.height-L*2),n=s-i.x,a=o-i.y;if(Math.sqrt(n*n+a*a)>=this.playerAvoidRadius&&this.isPositionValid({x:s,y:o}))return{x:s,y:o};e++}return{x:t.width/2,y:t.height/2}}isPositionValid(t){for(const i of this.orbs){const e=t.x-i.position.x,s=t.y-i.position.y;if(Math.sqrt(e*e+s*s)<this.minSpacing)return!1}return!0}getRandomWeaponType(){const t=[g.KINETIC_BOMB,g.BLASTER,g.ICE_BOMB,g.HOMING_MISSILE,g.NUCLEAR_BOMB,g.ELECTRIC_BOMB,g.DOT_REPELLENT,g.CHAINSAW,g.FLAME_BURST];return t[Math.floor(Math.random()*t.length)]}}class Pt{weapons=new Map;register(t,i){this.weapons.set(t,i)}create(t){const i=this.weapons.get(t);return i?new i:null}getAvailableTypes(){return Array.from(this.weapons.keys())}}const T=new Pt;class C{dots=[];startTime=0;isStarted=!1;killedDots=0;handlePlayerCollision(t,i){return!1}isActive(){return!1}getPosition(){return{x:0,y:0}}getRadius(){return 0}getDots(){return this.dots.filter(t=>!t.isDead())}isComplete(){return!1}start(){this.startTime=Date.now(),this.isStarted=!0}getElapsedTime(){return Date.now()-this.startTime}clear(){for(const t of this.dots)t.kill();this.dots=[]}getKilledDots(){return this.killedDots}addKilledDot(){this.killedDots++}}class Z extends C{type=g.NUCLEAR_BOMB;state="DRIFTING";orbPosition={x:0,y:0};orbVelocity={x:0,y:0};fuseTime=4e3;collisionCount=0;explosionRadius=0;explosionStartTime=0;killedDotsInExplosion=new Set;_hasKilledPlayer=!1;bounds=null;flashInterval=100;flashGap=400;lastCollisionTime=0;collisionCooldown=100;orbRadius=L;activate(t,i){this.dots=i,this.start(),this.orbPosition={x:t.position.x,y:t.position.y},this.orbVelocity={x:0,y:0}}handlePlayerCollision(t,i){const e=Date.now();if(e-this.lastCollisionTime<this.collisionCooldown)return!1;this.lastCollisionTime=e;const s=this.orbPosition.x-t.position.x,o=this.orbPosition.y-t.position.y,n=Math.sqrt(s*s+o*o),a=50,r=Math.sqrt(i.x**2+i.y**2);if(r<a)return!1;if(n===0)return this.orbVelocity.x=i.x,this.orbVelocity.y=i.y,!0;const h=s/n,c=o/n,p=-c,u=h,f=i.x*h+i.y*c,m=i.x*p+i.y*u,P=f/r;if(P<.1)return!1;const M=1.5;if(P>.7)this.orbVelocity.x=i.x*M,this.orbVelocity.y=i.y*M;else{const S=P,A=1-P;this.orbVelocity.x=(h*f*S+p*m*A)*M,this.orbVelocity.y=(c*f*S+u*m*A)*M}return!0}getPosition(){return this.orbPosition}getRadius(){return this.orbRadius}isActive(){return this.state!=="COMPLETE"}update(t,i,e,s){switch(this.bounds=s,this.state){case"DRIFTING":{const o=this.getElapsedTime();this.orbPosition.x+=this.orbVelocity.x*t,this.orbPosition.y+=this.orbVelocity.y*t;const n=this.orbRadius,a=s.width-this.orbRadius,r=this.orbRadius,h=s.height-this.orbRadius;this.orbPosition.x<=n?(this.orbVelocity.x=Math.abs(this.orbVelocity.x),this.orbPosition.x=n,this.collisionCount++):this.orbPosition.x>=a&&(this.orbVelocity.x=-Math.abs(this.orbVelocity.x),this.orbPosition.x=a,this.collisionCount++),this.orbPosition.y<=r?(this.orbVelocity.y=Math.abs(this.orbVelocity.y),this.orbPosition.y=r,this.collisionCount++):this.orbPosition.y>=h&&(this.orbVelocity.y=-Math.abs(this.orbVelocity.y),this.orbPosition.y=h,this.collisionCount++),(o>=this.fuseTime||this.collisionCount>=3)&&(this.state="EXPLODING",this.explosionStartTime=Date.now(),this.explosionRadius=.35*s.width,R.show("Nuclear Bomb detonated!","warning"),this.killDotsInExplosion(e),this.checkAndKillPlayer(i));break}case"EXPLODING":{Date.now()-this.explosionStartTime>500&&(this.state="COMPLETE");break}}}render(t){if(this.bounds)switch(this.state){case"DRIFTING":{const i=this.getElapsedTime(),e=Math.min(i/this.fuseTime,1),s=this.interpolateColor("#FF6600","#FF0000",e),o=.35*this.bounds.width,n=t.getContext(),a=this.fuseTime-1500;if(i>=a){const r=i-a,h=0,c=this.flashInterval+this.flashGap;let p=!1;(r>=h&&r<h+this.flashInterval||r>=c&&r<c+this.flashInterval)&&(p=!0),p&&(n.fillStyle="rgba(255, 165, 0, 0.6)",n.beginPath(),n.arc(this.orbPosition.x,this.orbPosition.y,o,0,Math.PI*2),n.fill())}t.drawCircleImmediate(this.orbPosition.x,this.orbPosition.y,this.orbRadius,s),n.strokeStyle="#9B30FF",n.lineWidth=3,n.beginPath(),n.arc(this.orbPosition.x,this.orbPosition.y,this.orbRadius+2,0,Math.PI*2),n.stroke(),this.drawNuclearIcon(n,this.orbPosition.x,this.orbPosition.y,this.orbRadius*.5);break}case"EXPLODING":{const i=Date.now()-this.explosionStartTime;if(i<=500){const e=.8-i/500*.8;t.drawCircle(this.orbPosition.x,this.orbPosition.y,this.explosionRadius,`rgba(255, 0, 0, ${e})`)}break}}}interpolateColor(t,i,e){const s=parseInt(t.slice(1,3),16),o=parseInt(t.slice(3,5),16),n=parseInt(t.slice(5,7),16),a=parseInt(i.slice(1,3),16),r=parseInt(i.slice(3,5),16),h=parseInt(i.slice(5,7),16),c=Math.round(s+(a-s)*e),p=Math.round(o+(r-o)*e),u=Math.round(n+(h-n)*e);return`#${c.toString(16).padStart(2,"0")}${p.toString(16).padStart(2,"0")}${u.toString(16).padStart(2,"0")}`}drawNuclearIcon(t,i,e,s){t.fillStyle="#FFFFFF",t.strokeStyle="#FFFFFF",t.lineWidth=2;const o=s*.7;t.beginPath(),t.arc(i,e-o*.1,o*.5,0,Math.PI*2),t.fill(),t.fillStyle="#000000",t.beginPath(),t.arc(i-o*.2,e-o*.15,o*.15,0,Math.PI*2),t.fill(),t.beginPath(),t.arc(i+o*.2,e-o*.15,o*.15,0,Math.PI*2),t.fill(),t.beginPath(),t.moveTo(i,e+o*.05),t.lineTo(i-o*.08,e+o*.2),t.lineTo(i+o*.08,e+o*.2),t.closePath(),t.fill(),t.fillStyle="#FFFFFF",t.beginPath(),t.rect(i-o*.25,e+o*.25,o*.5,o*.2),t.fill(),t.strokeStyle="#000000",t.lineWidth=1.5;for(let r=1;r<=2;r++){const h=i-o*.08*r;t.beginPath(),t.moveTo(h,e+o*.25),t.lineTo(h,e+o*.45),t.stroke();const c=i+o*.08*r;t.beginPath(),t.moveTo(c,e+o*.25),t.lineTo(c,e+o*.45),t.stroke()}t.strokeStyle="#FFFFFF",t.lineWidth=3,t.lineCap="round",t.beginPath(),t.moveTo(i-o*.7,e-o*.5),t.lineTo(i+o*.7,e+o*.5),t.stroke(),t.beginPath(),t.moveTo(i+o*.7,e-o*.5),t.lineTo(i-o*.7,e+o*.5),t.stroke(),t.fillStyle="#FFFFFF";const n=o*.1,a=[{x:i-o*.7,y:e-o*.5},{x:i+o*.7,y:e+o*.5},{x:i+o*.7,y:e-o*.5},{x:i-o*.7,y:e+o*.5}];for(const r of a)t.beginPath(),t.arc(r.x,r.y,n,0,Math.PI*2),t.fill()}isComplete(){return this.state==="COMPLETE"}hasKilledPlayer(){return this._hasKilledPlayer}killDotsInExplosion(t){for(const i of t){if(i.isDead()||this.killedDotsInExplosion.has(i))continue;const e=i.getPosition(),s=e.x-this.orbPosition.x,o=e.y-this.orbPosition.y;Math.sqrt(s*s+o*o)<=this.explosionRadius&&(i.kill(),this.addKilledDot(),this.killedDotsInExplosion.add(i))}}checkAndKillPlayer(t){if(this._hasKilledPlayer)return;const i=t.position.x-this.orbPosition.x,e=t.position.y-this.orbPosition.y;Math.sqrt(i*i+e*e)<=this.explosionRadius&&(this._hasKilledPlayer=!0)}}const Et="tilt-to-live-highscores";function wt(){try{const l=localStorage.getItem(Et);return l?JSON.parse(l).sort((i,e)=>e.score-i.score):[]}catch(l){return console.error("Failed to load highscores:",l),[]}}class Mt{renderer;input;state=D.MENU;lastFrameTime=0;isPaused=!1;accumulator=0;player=null;bounds;timeAlive=0;scoringSystem=new lt;collisionSystem;difficultyManager=new pt;patternManager=new mt;orbSpawner=new yt;activeWeapons=[];lastDeathEvent=null;menuElement;gameOverElement;permissionElement;newGameBtn;playAgainBtn;enableMotionBtn;finalScoreElement;constructor(){this.renderer=new v("game"),this.input=new rt,this.bounds=this.renderer.getBounds(),this.collisionSystem=new dt(this.bounds),this.menuElement=document.getElementById("menu"),this.gameOverElement=document.getElementById("game-over"),this.permissionElement=document.getElementById("permission-prompt"),this.newGameBtn=document.getElementById("new-game-btn"),this.playAgainBtn=document.getElementById("play-again-btn"),this.enableMotionBtn=document.getElementById("enable-motion-btn"),this.finalScoreElement=document.getElementById("final-score"),this.setupEventListeners(),this.checkPlatform(),this.gameLoop(0)}checkPlatform(){if(!("ontouchstart"in window)&&!("DeviceOrientationEvent"in window)){this.showElement("desktop-warning",!0);return}this.checkOrientation(),window.addEventListener("orientationchange",()=>this.checkOrientation()),window.addEventListener("resize",()=>this.checkOrientation())}checkOrientation(){const t=window.innerWidth>window.innerHeight;this.showElement("landscape-warning",t&&this.state===D.PLAYING)}showElement(t,i){const e=document.getElementById(t);e&&(e.style.display=i?"flex":"none")}setupEventListeners(){this.newGameBtn.addEventListener("click",()=>this.handleNewGameClick()),this.playAgainBtn.addEventListener("click",()=>this.handleNewGameClick()),this.enableMotionBtn.addEventListener("click",()=>this.requestMotionPermission()),window.addEventListener("resize",()=>{this.bounds=this.renderer.getBounds()}),document.addEventListener("visibilitychange",()=>{document.hidden&&this.state===D.PLAYING?this.pause():!document.hidden&&this.state===D.PAUSED&&this.resume()})}async handleNewGameClick(){if(this.input.needsPermissionRequest()){this.menuElement.classList.add("hidden"),this.permissionElement.style.display="flex";return}this.startGame()}async requestMotionPermission(){await this.input.requestPermission()?(this.permissionElement.style.display="none",this.startGame()):alert("Motion permission denied. The game requires device motion to play.")}startGame(){this.state=D.PLAYING,this.timeAlive=0,this.lastDeathEvent=null,this.scoringSystem.start(),this.collisionSystem.updateBounds(this.bounds);const t=this.bounds.width/2,i=this.bounds.height/2;this.player=new ht(t,i),this.patternManager.clear(),this.orbSpawner.initialize(this.bounds,this.player.getPosition()),this.activeWeapons=[],this.input.calibrateTiltBasis(),this.menuElement.classList.add("hidden"),this.gameOverElement.classList.add("hidden"),R.clear()}handleGameOver(){const t=this.scoringSystem.getScore();this.state=D.GAME_OVER,this.finalScoreElement.textContent=`Score: ${t}`;const i=document.getElementById("gameover-highscores");if(i){const o=wt();i.innerHTML=o.slice(0,10).map((n,a)=>`<li>${a+1}. ${n.score}</li>`).join("")}const e=document.getElementById("death-reason");e&&(e.textContent=this.lastDeathEvent?.message??"Unknown");const s=document.getElementById("recent-toasts");if(s){const o=R.getAllMessages();s.innerHTML=o.length>0?o.map(n=>`<li class="toast-${n.type}">${n.text}</li>`).join(""):'<li class="toast-info">No recent events</li>'}this.gameOverElement.classList.remove("hidden")}pause(){this.isPaused=!0}resume(){this.isPaused=!1,this.lastFrameTime=performance.now()}gameLoop=t=>{if(this.state!==D.PLAYING||this.isPaused){requestAnimationFrame(this.gameLoop);return}const i=t-this.lastFrameTime;for(this.lastFrameTime=t,this.accumulator+=i;this.accumulator>=G;)this.update(G/1e3),this.accumulator-=G;this.render(),requestAnimationFrame(this.gameLoop)};update(t){if(!this.player)return;this.timeAlive+=t;const i=this.input.getVelocity();this.player.update(t,i,this.bounds);const e=this.scoringSystem.getScore();this.difficultyManager.update(e),this.patternManager.setScore(e),this.patternManager.update(t,this.player.getPosition(),this.bounds),this.orbSpawner.update(this.bounds,this.player.getPosition());const s=this.patternManager.getAllDots();this.collisionSystem.rebuildGrid(s);const o=this.orbSpawner.getOrbs();for(const r of o)r.updatePosition(t,this.bounds);const n=this.collisionSystem.checkPlayerOrbCollision(this.player,o);if(n){const r=this.input.getVelocity();if(!n.bounce(r,this.player.getPosition())){const c=n.getWeaponType(),p=T.create(c);p&&(p.activate(this.player,s),this.activeWeapons.push(p),n.pickup(),this.orbSpawner.removeOrb(n),R.show(`Picked up ${this.formatWeaponName(c)}`,"success"))}}for(let r=this.activeWeapons.length-1;r>=0;r--){const h=this.activeWeapons[r];if(h.update(t,this.player,s,this.bounds),h.isActive()){const c=this.player.getPosition(),p=h.getPosition(),u=h.getRadius(),f=this.player.hitboxRadius,m=p.x-c.x,P=p.y-c.y,M=m*m+P*P,S=u+f;if(M<S*S){const A=this.input.getVelocity();h.handlePlayerCollision(this.player,A)}}if(h instanceof Z&&h.hasKilledPlayer()){this.lastDeathEvent={message:"Killed by Nuclear Bomb explosion",type:"nuclear_bomb",timestamp:Date.now()},this.handleGameOver();return}h.isComplete()&&(this.scoringSystem.addKills(h.getKilledDots()),this.activeWeapons.splice(r,1))}const a=this.collisionSystem.checkPlayerDotCollision(this.player);a&&(a.isLethal()?(this.lastDeathEvent={message:"Hit by a red dot",type:"dot",timestamp:Date.now()},this.handleGameOver()):a.isFrozen()&&(a.kill(),this.scoringSystem.addKills(1)))}render(){this.renderer.clear(nt);const t=this.orbSpawner.getOrbs();for(let e=0;e<t.length;e++)t[e].render(this.renderer);const i=this.patternManager.getAllDots();for(let e=0;e<i.length;e++)i[e].render(this.renderer);for(let e=0;e<this.activeWeapons.length;e++)this.activeWeapons[e].render(this.renderer);this.player&&this.player.render(this.renderer),this.renderer.flushBatches(),this.renderer.endFrame()}getState(){return this.state}getScore(){return this.scoringSystem.getScore()}formatWeaponName(t){return t.toLowerCase().split("_").map(i=>i.charAt(0).toUpperCase()+i.slice(1)).join(" ")}}const H=8,bt="#00CCFF",St=1/V,It=k-1;class j{position;velocity;state;patternId=null;spawnElapsed=0;currentScale=k;radius=w;frozenTime=0;thawDuration=3e3;preThawWarningTime=500;isZombie=!1;zombieSpeed=50;vibrationOffset={x:0,y:0};frozenBorderThickness=H;constructor(t,i,e=null){this.position=new I(t,i),this.velocity={x:0,y:0},this.state=E.SPAWNING,this.patternId=e}update(t,i,e){if(this.state===E.SPAWNING){this.spawnElapsed+=t*1e3;const s=this.spawnElapsed*St;s>=1?(this.state=E.ACTIVE,this.currentScale=1):this.currentScale=k-It*s;return}if(this.state===E.FROZEN){this.frozenTime+=t*1e3;const s=Math.min(this.frozenTime/this.thawDuration,1);this.frozenBorderThickness=H*(1-s);const o=this.thawDuration-this.frozenTime;if(o<=this.preThawWarningTime&&o>0){const n=2*(1-o/this.preThawWarningTime);this.vibrationOffset.x=(Math.random()-.5)*n,this.vibrationOffset.y=(Math.random()-.5)*n}else this.vibrationOffset.x=0,this.vibrationOffset.y=0;this.frozenTime>=this.thawDuration&&this.thaw(e);return}if(this.state===E.ACTIVE){if(this.isZombie&&e){const s=e.x-this.position.x,o=e.y-this.position.y,n=Math.sqrt(s*s+o*o);n>0&&(this.velocity.x=s/n*this.zombieSpeed,this.velocity.y=o/n*this.zombieSpeed)}this.position.x+=this.velocity.x*t,this.position.y+=this.velocity.y*t,K(this.position,i)}}render(t){const i=this.radius*this.currentScale;let e;switch(this.state){case E.SPAWNING:e=st;break;case E.FROZEN:e=ot;break;default:e=et}const s=this.position.x+this.vibrationOffset.x,o=this.position.y+this.vibrationOffset.y;if(t.drawCircle(s,o,i,e),this.state===E.SPAWNING){const n=1-this.currentScale/k;t.drawCircleOutline(s,o,i*1.5,`rgba(255,102,102,${n.toFixed(2)})`)}this.state===E.FROZEN&&(t.drawCircleOutline(s,o,i+this.frozenBorderThickness,bt),t.drawCircle(s,o,i,e))}isLethal(){return this.state===E.ACTIVE}isFrozen(){return this.state===E.FROZEN}freeze(){this.state===E.ACTIVE&&(this.state=E.FROZEN,this.velocity.x=0,this.velocity.y=0,this.frozenTime=0,this.frozenBorderThickness=H)}thaw(t){if(this.state===E.FROZEN&&(this.state=E.ACTIVE,this.isZombie=!0,this.vibrationOffset.x=0,this.vibrationOffset.y=0,t)){const i=t.x-this.position.x,e=t.y-this.position.y,s=Math.sqrt(i*i+e*e);s>0&&(this.velocity.x=i/s*this.zombieSpeed,this.velocity.y=e/s*this.zombieSpeed)}}kill(){this.state=E.DEAD}isDead(){return this.state===E.DEAD}getPosition(){return this.position}getRadius(){return this.radius}getEffectiveRadius(){return this.state===E.FROZEN?this.radius+this.frozenBorderThickness:this.radius}}class O{dots=[];elapsedMs=0;isStarted=!1;spawnDot(t,i,e={x:0,y:0}){const s=new j(t,i,this.type);return s.velocity.x=e.x,s.velocity.y=e.y,this.dots.push(s),s}getDots(){return this.dots.filter(t=>!t.isDead())}isComplete(){return!1}start(){this.elapsedMs=0,this.isStarted=!0}getElapsedTime(){return this.elapsedMs}tick(t){this.elapsedMs+=t*1e3}render(t){}clear(){for(let t=0;t<this.dots.length;t++)this.dots[t].kill();this.dots=[]}}class xt extends O{type=y.ZOMBIE_SNOW;difficulty=d.EASY;spawnInterval;elapsedSinceSpawn=0;duration=15e3;dotSpeed=50;constructor(t=d.EASY){switch(super(),this.difficulty=t,t){case d.HARD:this.spawnInterval=150;break;case d.MEDIUM:this.spawnInterval=300;break;default:this.spawnInterval=500}}spawn(t,i){this.start()}update(t,i,e){this.elapsedMs<=this.duration&&(this.elapsedSinceSpawn+=t*1e3,this.elapsedSinceSpawn>=this.spawnInterval&&(this.elapsedSinceSpawn=0,this.spawnDotAtRandomPosition(e)));for(let s=this.dots.length-1;s>=0;s--){const o=this.dots[s];if(!o.isLethal()){o.update(t,e,i);continue}const n=o.getPosition();if(n.x<-100||n.x>e.width+100||n.y<-100||n.y>e.height+100){this.dots.splice(s,1);continue}const a=i.x-n.x,r=i.y-n.y,h=Math.sqrt(a*a+r*r);h>0&&(o.velocity.x=a/h*this.dotSpeed,o.velocity.y=r/h*this.dotSpeed),o.update(t,e,i)}}spawnDotAtRandomPosition(t){const i=w*2,e=q(t,i);this.spawnDot(e.x,e.y)}isComplete(){return this.elapsedMs>this.duration&&this.getDots().length===0}}class Tt extends O{type=y.SWEEPER_LINE;difficulty=d.EASY;duration=2e4;dotSpacing=20;holeSize=40;isHorizontal=!0;lineVelocity=0;sweepSpeed=150;linePos=0;lineOffset=0;dotOffsets=[];constructor(t=d.EASY){switch(super(),this.difficulty=t,t){case d.HARD:this.sweepSpeed=220;break;case d.MEDIUM:this.sweepSpeed=180;break;default:this.sweepSpeed=140}}spawn(t,i){this.start(),this.isHorizontal=Math.random()>.5,this.isHorizontal?this.lineOffset=Math.random()*(i.width-200)+100:this.lineOffset=Math.random()*(i.height-200)+100,this.isHorizontal?(this.lineVelocity=Math.random()>.5?this.sweepSpeed:-this.sweepSpeed,this.linePos=this.lineVelocity>0?-50:i.height+50):(this.lineVelocity=Math.random()>.5?this.sweepSpeed:-this.sweepSpeed,this.linePos=this.lineVelocity>0?-50:i.width+50),this.generateLineWithHoles(i)}generateLineWithHoles(t){const i=Math.floor(Math.random()*2)+2,e=this.isHorizontal?t.height:t.width,s=Math.floor((e-100)/this.dotSpacing),o=new Set,n=Math.ceil(this.holeSize/this.dotSpacing);for(let r=0;r<i;r++){const h=Math.floor(Math.random()*(s-10))+5;for(let c=-Math.floor(n/2);c<=Math.floor(n/2);c++)o.add(h+c)}const a=(e-s*this.dotSpacing)/2;for(let r=0;r<s;r++)if(!o.has(r)){const h=a+r*this.dotSpacing;this.dotOffsets.push(h),this.isHorizontal?this.spawnDot(this.lineOffset+h-e/2,this.linePos,{x:0,y:0}):this.spawnDot(this.linePos,this.lineOffset+h-e/2,{x:0,y:0})}}update(t,i,e){this.linePos+=this.lineVelocity*t,this.isHorizontal?this.lineVelocity>0&&this.linePos>e.height+50?this.lineVelocity=-this.sweepSpeed:this.lineVelocity<0&&this.linePos<-50&&(this.lineVelocity=this.sweepSpeed):this.lineVelocity>0&&this.linePos>e.width+50?this.lineVelocity=-this.sweepSpeed:this.lineVelocity<0&&this.linePos<-50&&(this.lineVelocity=this.sweepSpeed);const s=this.isHorizontal?e.height:e.width;for(let o=0;o<this.dots.length;o++){const n=this.dots[o];if(n.isFrozen()){n.update(t,e,i);continue}const a=this.dotOffsets[o];this.isHorizontal?(n.position.x=this.lineOffset+a-s/2,n.position.y=this.linePos):(n.position.x=this.linePos,n.position.y=this.lineOffset+a-s/2),n.update(t,e,i)}for(let o=this.dots.length-1;o>=0;o--)this.dots[o].isDead()&&(this.dots.splice(o,1),this.dotOffsets.splice(o,1))}isComplete(){return this.elapsedMs>this.duration&&this.dots.length===0}}class At extends O{type=y.SPARSE_GRID;difficulty=d.EASY;dotSpeed=20;constructor(t=d.EASY){switch(super(),this.difficulty=t,t){case d.HARD:this.dotSpeed=40;break;case d.MEDIUM:this.dotSpeed=30;break;default:this.dotSpeed=20}}spawn(t,i){this.start(),this.spawnGrid(i)}update(t,i,e){for(let s=this.dots.length-1;s>=0;s--){const o=this.dots[s];if(!o.isLethal()){o.update(t,e,i);continue}const n=o.getPosition();if(n.x<-100||n.x>e.width+100||n.y<-100||n.y>e.height+100){this.dots.splice(s,1);continue}const a=i.x-n.x,r=i.y-n.y,h=Math.sqrt(a*a+r*r);if(h>0){const c=h>50?this.dotSpeed:this.dotSpeed*(h/50);o.velocity.x=a/h*c,o.velocity.y=r/h*c}o.update(t,e,i)}}spawnGrid(t){const s=Math.floor((t.width-200)/85),o=Math.floor((t.height-200)/85);for(let n=0;n<o;n++)for(let a=0;a<s;a++){const r=100+a*85+42.5,h=100+n*85+85/2;this.spawnDot(r,h,{x:0,y:0})}}isComplete(){return this.getDots().length===0}}class vt extends O{type=y.BOUNCING_BALL;difficulty=d.MEDIUM;duration=3e4;ballRadius=120;dotCount=200;centerPosition={x:0,y:0};centerVelocity={x:0,y:0};dotOffsets=[];speed=120;constructor(t=d.MEDIUM){switch(super(),this.difficulty=t,t){case d.HARD:this.speed=180;break;case d.MEDIUM:this.speed=120;break;default:this.speed=80}}spawn(t,i){this.start(),this.centerPosition={x:i.width/2,y:i.height/2};const e=Math.random()*Math.PI*2;this.centerVelocity={x:Math.cos(e)*this.speed,y:Math.sin(e)*this.speed},this.spawnDots()}spawnDots(){this.dotOffsets=[];const t=20,i=Math.ceil(this.dotCount/t);for(let e=0;e<i;e++){const s=this.ballRadius*(e+1)/i,o=Math.min(t,this.dotCount-this.dotOffsets.length);for(let n=0;n<o;n++){const a=n/o*Math.PI*2;this.dotOffsets.push({x:Math.cos(a)*s,y:Math.sin(a)*s})}if(this.dotOffsets.length>=this.dotCount)break}for(let e=0;e<this.dotOffsets.length;e++){const s=this.dotOffsets[e];this.spawnDot(this.centerPosition.x+s.x,this.centerPosition.y+s.y,{x:this.centerVelocity.x,y:this.centerVelocity.y})}}update(t,i,e){this.centerPosition.x+=this.centerVelocity.x*t,this.centerPosition.y+=this.centerVelocity.y*t;const s=this.ballRadius+w,o=e.width-this.ballRadius-w,n=this.ballRadius+w,a=e.height-this.ballRadius-w;this.centerPosition.x<=s?(this.centerPosition.x=s,this.centerVelocity.x=Math.abs(this.centerVelocity.x)):this.centerPosition.x>=o&&(this.centerPosition.x=o,this.centerVelocity.x=-Math.abs(this.centerVelocity.x)),this.centerPosition.y<=n?(this.centerPosition.y=n,this.centerVelocity.y=Math.abs(this.centerVelocity.y)):this.centerPosition.y>=a&&(this.centerPosition.y=a,this.centerVelocity.y=-Math.abs(this.centerVelocity.y));for(let r=0;r<this.dots.length;r++){const h=this.dots[r];if(h.isFrozen()){h.update(t,e,i);continue}const c=this.dotOffsets[r];c&&!h.isDead()&&(h.position.x=this.centerPosition.x+c.x,h.position.y=this.centerPosition.y+c.y,h.velocity.x=this.centerVelocity.x,h.velocity.y=this.centerVelocity.y),h.update(t,e,i)}}isComplete(){return this.elapsedMs>this.duration&&this.getDots().length===0}}class Ct extends O{type=y.GATLING_POINT;difficulty=d.MEDIUM;shootDuration;dotSpeed=400;shootInterval=100;elapsedSinceSpawn=0;spawnPoint={x:0,y:0};constructor(t=d.MEDIUM){switch(super(),this.difficulty=t,t){case d.HARD:this.shootDuration=6e3,this.shootInterval=50;break;case d.MEDIUM:this.shootDuration=4500,this.shootInterval=80;break;default:this.shootDuration=3e3,this.shootInterval=100}}spawn(t,i){this.start();const e=50;this.spawnPoint=q(i,e)}update(t,i,e){this.elapsedMs<=this.shootDuration&&(this.elapsedSinceSpawn+=t*1e3,this.elapsedSinceSpawn>=this.shootInterval&&(this.elapsedSinceSpawn=0,this.spawnDotAtPoint(i)));for(let s=this.dots.length-1;s>=0;s--){const o=this.dots[s];if(!o.isLethal()){o.update(t,e,i);continue}const n=o.getPosition(),a=o.velocity;if(n.x<-100||n.x>e.width+100||n.y<-100||n.y>e.height+100){this.dots.splice(s,1);continue}(n.x<w||n.x>e.width-w)&&(a.x=-a.x),(n.y<w||n.y>e.height-w)&&(a.y=-a.y),o.update(t,e,i)}}spawnDotAtPoint(t){const i=t.x-this.spawnPoint.x,e=t.y-this.spawnPoint.y,s=Math.sqrt(i*i+e*e);s>0?this.spawnDot(this.spawnPoint.x,this.spawnPoint.y,{x:i/s*this.dotSpeed,y:e/s*this.dotSpeed}):this.spawnDot(this.spawnPoint.x,this.spawnPoint.y)}isComplete(){return this.elapsedMs>this.shootDuration&&this.getDots().length===0}}class Dt extends O{type=y.BULLET_HELL;difficulty=d.HARD;duration=1e4;dotSpeed=300;warningDuration=V;originX=0;originY=0;isFromTop=!1;hasStartedSpawning=!1;hasSpawnedBullets=!1;spawnTimeoutId=null;constructor(t=d.HARD){switch(super(),this.difficulty=t,t){case d.HARD:this.duration=15e3;break;case d.MEDIUM:this.duration=12e3;break}}spawn(t,i){this.start(),this.hasStartedSpawning=!1,this.hasSpawnedBullets=!1,this.isFromTop=Math.random()>.5,this.originX=i.width/2,this.originY=this.isFromTop?-50:i.height+50,this.spawnTimeoutId=window.setTimeout(()=>{this.hasStartedSpawning=!0},this.warningDuration)}update(t,i,e){this.hasStartedSpawning&&this.elapsedMs<=this.duration+this.warningDuration&&this.spawnBullets();for(let s=this.dots.length-1;s>=0;s--){const o=this.dots[s];if(o.isFrozen()){o.update(t,e,i);continue}const n=o.getPosition();if(n.x<-w||n.x>e.width+w||n.y<-w||n.y>e.height+w){this.dots.splice(s,1);continue}o.position.x+=o.velocity.x*t,o.position.y+=o.velocity.y*t}}render(t){if(super.render?.(t),!this.hasStartedSpawning&&this.isStarted){const i=Math.min(this.elapsedMs/this.warningDuration,1),e=1.5-.5*i,s=1-i;t.drawCircle(this.originX,this.originY,w*e*2,`rgba(255, 102, 102, ${s.toFixed(2)})`),t.drawCircleOutline(this.originX,this.originY,w*e*3,`rgba(255, 0, 0, ${s.toFixed(2)})`)}}spawnBullets(){if(this.hasSpawnedBullets)return;this.hasSpawnedBullets=!0;const t=6,i=Math.PI*2/t;for(let e=0;e<t;e++){const s=e*i;for(let o=0;o<4;o++){const n=o*200,a=s+Math.sin(this.elapsedMs*.001+n*.001)*.3,r=this.originX+Math.cos(a)*50,h=new j(r,this.originY,this.type);h.velocity.x=Math.cos(a)*this.dotSpeed,h.velocity.y=Math.sin(a)*this.dotSpeed,h.state=E.ACTIVE,this.dots.push(h)}}}isComplete(){return this.elapsedMs>this.duration+this.warningDuration&&this.getDots().length===0}clear(){this.spawnTimeoutId!==null&&(window.clearTimeout(this.spawnTimeoutId),this.spawnTimeoutId=null),this.hasStartedSpawning=!1,this.hasSpawnedBullets=!1,super.clear()}}class Rt extends O{type=y.CONTAINMENT_RING;difficulty=d.EASY;ringRadius=100;dotSpeed=30;dotCount=40;innerRadius=20;constructor(t=d.EASY){super(),this.difficulty=t}spawn(t,i){this.start(),this.spawnRing(t,i)}update(t,i,e){for(let s=this.dots.length-1;s>=0;s--){const o=this.dots[s];if(!o.isLethal()){o.update(t,e,i);continue}const n=o.getPosition();if(n.x<-100||n.x>e.width+100||n.y<-100||n.y>e.height+100){this.dots.splice(s,1);continue}const a=i.x-n.x,r=i.y-n.y,h=Math.sqrt(a*a+r*r);h>this.innerRadius?(o.velocity.x=a/h*this.dotSpeed,o.velocity.y=r/h*this.dotSpeed):(o.velocity.x=0,o.velocity.y=0),o.update(t,e,i)}}spawnRing(t,i){const e=Math.floor(Math.random()*5),s=e>0?2:0,o=[];for(let n=0;n<e;n++){const a=this.dotCount*n/e+Math.floor(this.dotCount/(e*2)),r=a-s,h=a+s;o.push([r,h])}for(let n=0;n<this.dotCount;n++){if(o.some(([p,u])=>n>=p&&n<=u))continue;const r=2*Math.PI*n/this.dotCount,h=t.x+this.ringRadius*Math.cos(r),c=t.y+this.ringRadius*Math.sin(r);this.spawnDot(h,c)}}isComplete(){return this.getDots().length===0}}class Ot extends O{type=y.CYCLONE;difficulty=d.HARD;duration=25e3;circleRadius=50;dotSpeed=150;constructor(t=d.HARD){switch(super(),this.difficulty=t,t){case d.HARD:this.dotSpeed=300,this.circleRadius=80;break;case d.MEDIUM:this.dotSpeed=200,this.circleRadius=60;break;default:this.dotSpeed=150,this.circleRadius=50}}spawn(t,i){this.start(),this.spawnDots(i)}update(t,i,e){for(let s=this.dots.length-1;s>=0;s--){const o=this.dots[s];if(!o.isLethal()){o.update(t,e,i);continue}const n=o.getPosition();if(n.x<-50||n.x>e.width+50||n.y<-50||n.y>e.height+50){this.dots.splice(s,1);continue}o.update(t,e,i)}}spawnDots(t){const i=t.width/2,e=t.height/2,s=150;for(let o=0;o<s;o++){const a=o/s*Math.PI*2+(Math.random()-.5)*.2,r=this.circleRadius*(.8+Math.random()*.4),h=i+Math.cos(a)*r,c=e+Math.sin(a)*r,p=a+Math.PI/2+(Math.random()-.5)*.5,u=this.dotSpeed*(.5+Math.random()*1);this.spawnDot(h,c,{x:Math.cos(p)*u,y:Math.sin(p)*u})}}isComplete(){return this.elapsedMs>this.duration&&this.getDots().length===0}}class Lt extends C{type=g.BLASTER;state="AIMING";aimTime=1e3;aimStartTime=0;beamPosition=0;prevBeamPosition=0;beamAngle=0;playerPosition={x:0,y:0};playerAngle=0;beamOriginPosition={x:0,y:0};activate(t,i){this.start(),this.dots=i,this.aimStartTime=Date.now(),this.playerPosition=t.getPosition(),this.playerAngle=t.directionAngle,this.beamAngle=this.playerAngle,this.state="AIMING"}update(t,i,e,s){if(this.state==="COMPLETE")return;const o=Date.now()-this.aimStartTime;this.state==="AIMING"?(this.playerPosition=i.getPosition(),this.playerAngle=i.directionAngle,o>=this.aimTime&&(this.state="FIRING",this.beamAngle=this.playerAngle,this.beamOriginPosition={...this.playerPosition})):this.state==="FIRING"&&(this.prevBeamPosition=this.beamPosition,this.beamPosition+=500*t,this.checkBeamCollision(e),this.beamPosition>Math.max(s.width,s.height)&&(this.state="COMPLETE"))}checkBeamCollision(t){if(!t||t.length===0)return;const i=Math.cos(this.beamAngle),e=Math.sin(this.beamAngle);for(const s of t)if(!s.isDead()){const o=s.getPosition(),n=s.getRadius(),a=o.x-this.beamOriginPosition.x,r=o.y-this.beamOriginPosition.y,h=a*i+r*e,c=a*e-r*i,p=50+n,u=100+n;if(!(Math.abs(c)<=p))continue;const m=this.prevBeamPosition-u,P=this.beamPosition+u;h>=m&&h<=P&&(s.kill(),this.addKilledDot())}}render(t){if(this.state==="COMPLETE")return;const i=t.getContext();if(this.state==="AIMING"){const e=this.playerPosition.x,s=this.playerPosition.y;i.save(),i.translate(e,s),i.rotate(this.playerAngle),i.fillStyle="rgb(128, 0, 128)",i.fillRect(0,-6,20,12),i.restore()}else if(this.state==="FIRING"){const e=this.beamOriginPosition.x+this.beamPosition*Math.cos(this.beamAngle),s=this.beamOriginPosition.y+this.beamPosition*Math.sin(this.beamAngle);i.save(),i.translate(e,s),i.rotate(this.beamAngle),i.fillStyle="rgba(128, 0, 255, 0.78)",i.fillRect(-5,-75,10,150),i.restore()}}isComplete(){return this.state==="COMPLETE"}}class Nt extends C{type=g.CHAINSAW;duration=2500;chainsawRadius=50;playerPosition={x:0,y:0};warningStartTime=2100;flashDuration=100;flashGap=300;activate(t,i){this.start(),this.playerPosition=t.getPosition()}update(t,i,e,s){if(!(this.getElapsedTime()>=this.duration)&&!(!e||e.length===0)){this.playerPosition=i.getPosition();for(const o of e){if(!o.isLethal())continue;const n=o.getPosition(),a=n.x-this.playerPosition.x,r=n.y-this.playerPosition.y;Math.sqrt(a*a+r*r)<=this.chainsawRadius&&(o.kill(),this.addKilledDot())}}}shouldShowVisual(){const t=this.getElapsedTime();if(t<this.warningStartTime)return!0;const i=t-this.warningStartTime,e=i<this.flashDuration,s=i>=this.flashGap&&i<this.flashGap+this.flashDuration;return!e&&!s}render(t){this.shouldShowVisual()&&t.drawCircle(this.playerPosition.x,this.playerPosition.y,this.chainsawRadius,$.CHAINSAW+"99")}isComplete(){return this.getElapsedTime()>=this.duration}getChainsawRadius(){return this.chainsawRadius}}class Ft extends C{type=g.DOT_REPELLENT;duration=8e3;fieldRadius=100;playerPosition={x:0,y:0};activate(t,i){this.start(),this.dots=[],this.playerPosition=t.getPosition()}update(t,i,e,s){if(!(this.getElapsedTime()>=this.duration)&&!(!e||e.length===0)){this.playerPosition=i.getPosition();for(const n of e){if(!n.isLethal())continue;const a=n.getPosition(),r=a.x-this.playerPosition.x,h=a.y-this.playerPosition.y,c=Math.sqrt(r*r+h*h);if(c<this.fieldRadius&&c>0){const p=5*(1-c/this.fieldRadius);n.position.x+=r/c*p,n.position.y+=h/c*p}}}}render(t){const i=t.getContext();i.save(),i.beginPath(),i.arc(this.playerPosition.x,this.playerPosition.y,this.fieldRadius,0,Math.PI*2),i.strokeStyle="rgba(128, 128, 128, 0.3)",i.lineWidth=3,i.stroke(),i.restore()}isComplete(){return this.getElapsedTime()>=this.duration}}class _t extends C{type=g.ELECTRIC_BOMB;state="ROLLING";orbPosition={x:0,y:0};orbVelocity={x:0,y:0};chainNodes=[];lightningArcs=[];dotsToProcess=[];initialRadiusFactor=.15;chainRadiusFactor=.1;maxChainDepth=50;orbSpeed=300;orbRadius=12;rollingDuration=2e3;chainDelayMs=80;lastChainTime=0;bounds=null;lastCollisionTime=0;collisionCooldown=100;activate(t,i){this.dots=i,this.start(),this.orbPosition={...t.getPosition()};const e=Math.random()*Math.PI*2;this.orbVelocity={x:Math.cos(e)*this.orbSpeed,y:Math.sin(e)*this.orbSpeed},this.state="ROLLING"}update(t,i,e,s){switch(this.bounds===null&&(this.bounds=s),this.state){case"ROLLING":this.updateRolling(t,s);break;case"CHAINING":this.updateChaining(e,i,s);break}}getPosition(){return this.orbPosition}getRadius(){return this.orbRadius}handlePlayerCollision(t,i){const e=Date.now();if(e-this.lastCollisionTime<this.collisionCooldown)return!1;this.lastCollisionTime=e;const s=this.orbPosition.x-t.position.x,o=this.orbPosition.y-t.position.y,n=Math.sqrt(s*s+o*o),a=50,r=Math.sqrt(i.x**2+i.y**2);if(r<a)return!1;if(n===0)return this.orbVelocity.x=i.x,this.orbVelocity.y=i.y,!0;const h=s/n,c=o/n,p=-c,u=h,f=i.x*h+i.y*c,m=i.x*p+i.y*u,P=f/r;if(P<.1)return!1;const M=1.5;if(P>.7)this.orbVelocity.x=i.x*M,this.orbVelocity.y=i.y*M;else{const S=P,A=1-P;this.orbVelocity.x=(h*f*S+p*m*A)*M,this.orbVelocity.y=(c*f*S+u*m*A)*M}return!0}updateRolling(t,i){this.orbPosition.x+=this.orbVelocity.x*t,this.orbPosition.y+=this.orbVelocity.y*t,this.orbPosition.x-this.orbRadius<0?(this.orbPosition.x=this.orbRadius,this.orbVelocity.x=Math.abs(this.orbVelocity.x)):this.orbPosition.x+this.orbRadius>i.width&&(this.orbPosition.x=i.width-this.orbRadius,this.orbVelocity.x=-Math.abs(this.orbVelocity.x)),this.orbPosition.y-this.orbRadius<0?(this.orbPosition.y=this.orbRadius,this.orbVelocity.y=Math.abs(this.orbVelocity.y)):this.orbPosition.y+this.orbRadius>i.height&&(this.orbPosition.y=i.height-this.orbRadius,this.orbVelocity.y=-Math.abs(this.orbVelocity.y)),this.getElapsedTime()>=this.rollingDuration&&this.triggerInitialExplosion()}triggerInitialExplosion(){this.state="CHAINING",this.lastChainTime=Date.now(),R.show("Electric Bomb discharged!","warning");const t=(this.bounds?.width??800)*this.initialRadiusFactor;this.chainNodes.push({x:this.orbPosition.x,y:this.orbPosition.y,radius:t,activatedAt:Date.now(),chainDepth:0}),this.findAndElectrifyDots(this.chainNodes[0])}findAndElectrifyDots(t){for(const i of this.dots){if(i.isDead())continue;const e=i.getPosition(),s=e.x-t.x,o=e.y-t.y;if(Math.sqrt(s*s+o*o)<=t.radius){i.kill(),this.addKilledDot(),this.lightningArcs.push({x1:t.x,y1:t.y,x2:e.x,y2:e.y,createdAt:Date.now(),chainDepth:t.chainDepth});const a={x:e.x,y:e.y,radius:(this.bounds?.width??800)*this.chainRadiusFactor,activatedAt:Date.now(),chainDepth:t.chainDepth+1,parentX:t.x,parentY:t.y};this.chainNodes.push(a),this.dotsToProcess.push(i)}}}updateChaining(t,i,e){if(!t||t.length===0){this.state="COMPLETE";return}const s=Date.now();if(s-this.lastChainTime<this.chainDelayMs)return;this.lastChainTime=s;const o=this.chainNodes.filter(n=>n.chainDepth>0&&s-n.activatedAt<100&&n.chainDepth<this.maxChainDepth);if(o.length===0){this.checkPlayerHit(i);const n=this.chainNodes.filter(r=>s-r.activatedAt<600),a=this.chainNodes.some(r=>r.chainDepth>0);(n.length===0||!a)&&(this.state="COMPLETE");return}for(const n of o)this.findAndElectrifyDots(n);this.checkPlayerHit(i)}checkPlayerHit(t){}render(t){this.state==="ROLLING"?(t.drawCircle(this.orbPosition.x,this.orbPosition.y,this.orbRadius,"#00FFFF"),t.drawCircleOutline(this.orbPosition.x,this.orbPosition.y,this.orbRadius+4,"rgba(0, 255, 255, 0.5)",2)):(this.state==="CHAINING"||this.state==="COMPLETE")&&(this.renderChainNodes(t),this.renderLightning(t))}renderChainNodes(t){const i=Date.now(),e=500;this.chainNodes=this.chainNodes.filter(s=>i-s.activatedAt<e+100);for(const s of this.chainNodes){const o=i-s.activatedAt,n=Math.max(0,1-o/e);n>0&&(t.drawCircle(s.x,s.y,s.radius,`rgba(0, 255, 255, ${n*.3})`),t.drawCircleOutline(s.x,s.y,s.radius,`rgba(0, 255, 255, ${n})`,3))}}renderLightning(t){const i=Date.now(),e=500;this.lightningArcs=this.lightningArcs.filter(s=>i-s.createdAt<e);for(const s of this.lightningArcs){const o=i-s.createdAt,n=Math.max(0,1-o/e);n>0&&this.drawJaggedLightning(t,s.x1,s.y1,s.x2,s.y2,n,s.chainDepth)}}drawJaggedLightning(t,i,e,s,o,n,a){const r=3+Math.min(a,3),h=6+a*2,c=`rgba(0, 200, 255, ${n})`,p=`rgba(100, 230, 255, ${n*.5})`,u=[];u.push({x:i,y:e});for(let f=1;f<r;f++){const m=f/r,P=i+(s-i)*m,M=e+(o-e)*m,S=(Math.random()-.5)*h*2,A=(Math.random()-.5)*h*2;u.push({x:P+S,y:M+A})}u.push({x:s,y:o});for(let f=0;f<u.length-1;f++)t.drawLine(u[f].x,u[f].y,u[f+1].x,u[f+1].y,p,4);for(let f=0;f<u.length-1;f++)t.drawLine(u[f].x,u[f].y,u[f+1].x,u[f+1].y,c,2)}isActive(){return this.state==="ROLLING"}isComplete(){return this.state==="COMPLETE"}hasKilledPlayer(){return!1}getExplosionCount(){return this.chainNodes.length}}class Bt extends C{type=g.FLAME_BURST;FLAME_DURATION_MS=3e3;CONE_ANGLE_RAD=Math.PI/3;FLAME_REACH_PX=200;TRAIL_DURATION_MS=1e3;PARTICLE_MAX_AGE_MS=200;PARTICLE_AGE_VARIANCE_MS=100;PARTICLES_PER_FRAME=5;FRAME_TIME_MS=16;playerPosition={x:0,y:0};playerAngle=0;flames=[];trails=[];flameActive=!1;complete=!1;activate(t,i){this.start(),this.dots=i,this.playerPosition=t.getPosition(),this.playerAngle=t.directionAngle,this.flames=[],this.trails=[],this.flameActive=!0,this.complete=!1}update(t,i,e,s){if(this.complete)return;if(this.getElapsedTime()>=this.FLAME_DURATION_MS){this.flameActive=!1;const a=Date.now();this.trails=this.trails.filter(r=>a-r.startTime<r.duration),this.trails.length===0&&(this.complete=!0);return}this.playerPosition=i.getPosition(),this.playerAngle=i.directionAngle,this.spawnFlameParticles(),this.flames=this.flames.filter(a=>(a.age+=this.FRAME_TIME_MS,a.age<a.maxAge)),Math.random()<.3&&this.spawnFireTrail();const n=Date.now();this.trails=this.trails.filter(a=>n-a.startTime<a.duration),this.killDotsInFlameCone(e)}spawnFlameParticles(){for(let t=0;t<this.PARTICLES_PER_FRAME;t++){const i=(Math.random()-.5)*this.CONE_ANGLE_RAD,e=this.playerAngle+i,s=Math.random()*this.FLAME_REACH_PX,o=(Math.random()-.5)*20,n=(Math.random()-.5)*20;this.flames.push({x:this.playerPosition.x+Math.cos(e)*s+o,y:this.playerPosition.y+Math.sin(e)*s+n,age:0,maxAge:this.PARTICLE_MAX_AGE_MS+Math.random()*this.PARTICLE_AGE_VARIANCE_MS})}}spawnFireTrail(){const t=(Math.random()-.5)*this.CONE_ANGLE_RAD,i=this.playerAngle+t,e=20+Math.random()*60;this.trails.push({x:this.playerPosition.x+Math.cos(i)*e,y:this.playerPosition.y+Math.sin(i)*e,startTime:Date.now(),duration:this.TRAIL_DURATION_MS})}killDotsInFlameCone(t){if(!t||t.length===0)return;const i=this.CONE_ANGLE_RAD/2;for(const e of t){if(e.isDead())continue;const s=e.getPosition(),o=s.x-this.playerPosition.x,n=s.y-this.playerPosition.y;if(Math.sqrt(o*o+n*n)>this.FLAME_REACH_PX)continue;let h=Math.atan2(n,o)-this.playerAngle;for(;h>Math.PI;)h-=Math.PI*2;for(;h<-Math.PI;)h+=Math.PI*2;Math.abs(h)<=i&&(e.kill(),this.addKilledDot())}}render(t){if(this.complete)return;const i=t.getContext(),e=Date.now();this.renderTrails(i,e),this.flameActive&&(this.renderFlameCone(i),this.renderFlameParticles(i))}renderTrails(t,i){for(const e of this.trails){const o=(i-e.startTime)/e.duration,n=Math.max(0,1-o),a=8+o*5;t.beginPath(),t.arc(e.x,e.y,a,0,Math.PI*2),t.fillStyle=`rgba(255, 100, 0, ${n*.6})`,t.fill(),t.beginPath(),t.arc(e.x,e.y,a*.5,0,Math.PI*2),t.fillStyle=`rgba(255, 200, 50, ${n*.8})`,t.fill()}}renderFlameCone(t){t.save(),t.translate(this.playerPosition.x,this.playerPosition.y),t.rotate(this.playerAngle);const i=t.createRadialGradient(0,0,0,0,0,this.FLAME_REACH_PX);i.addColorStop(0,"rgba(255, 150, 0, 0.3)"),i.addColorStop(.5,"rgba(255, 100, 0, 0.2)"),i.addColorStop(1,"rgba(255, 50, 0, 0)"),t.beginPath(),t.moveTo(0,0),t.arc(0,0,this.FLAME_REACH_PX,-this.CONE_ANGLE_RAD/2,this.CONE_ANGLE_RAD/2),t.closePath(),t.fillStyle=i,t.fill(),t.restore()}renderFlameParticles(t){for(const i of this.flames){const e=i.age/i.maxAge,s=Math.max(0,1-e),o=6+e*8;t.beginPath(),t.arc(i.x,i.y,o,0,Math.PI*2),t.fillStyle=`rgba(255, ${Math.floor(100+e*50)}, 0, ${s*.5})`,t.fill(),t.beginPath(),t.arc(i.x,i.y,o*.4,0,Math.PI*2),t.fillStyle=`rgba(255, ${Math.floor(200+e*55)}, ${Math.floor(50+e*100)}, ${s*.8})`,t.fill()}}isComplete(){return this.complete}}const b=6,kt="#FF6B00",Gt="rgba(255, 107, 0, 0.3)",Y=5*Math.PI/180,X=45,Ut=15,Ht=500,Wt=250,zt="#FFD700";class Yt extends C{type=g.HOMING_MISSILE;missiles=[];explosions=[];missileSpeed=800;activate(t,i){this.start(),this.dots=i,this.missiles=[],this.explosions=[];const e=t.getPosition(),s=t.directionAngle,o=t.velocity,n=Math.sqrt(o.x**2+o.y**2)*.5,a=this.missileSpeed+n,r=[s-Math.PI/6,s,s+Math.PI/6];for(const h of r){const c={x:e.x,y:e.y,vx:Math.cos(h)*a,vy:Math.sin(h)*a,angle:h,target:null,active:!0};this.missiles.push(c)}}findBestTarget(t,i){if(!i||i.length===0)return null;let e=null,s=1/0;for(const o of i){if(o.isDead()||!o.isLethal())continue;const n=o.getPosition(),a=U(t,n),r=Math.atan2(n.y-t.y,n.x-t.x),h=Math.abs(this.normalizeAngle(r-t.angle)),c=a*(1+h);c<s&&(s=c,e=o)}return e}normalizeAngle(t){for(;t>Math.PI;)t-=2*Math.PI;for(;t<-Math.PI;)t+=2*Math.PI;return t}createExplosion(t,i){const e=[];for(let o=0;o<4;o++){const n=Math.random()*Math.PI*2,a=Math.random()*X*.6;e.push({x:Math.cos(n)*a,y:Math.sin(n)*a,radius:Ut*(.8+Math.random()*.4)})}const s={x:t,y:i,startTime:Date.now(),duration:Ht,mainRadius:X,subExplosions:e,hasAppliedDamage:!1,active:!0};this.explosions.push(s)}applyExplosionDamage(t,i){if(!t.hasAppliedDamage){for(const e of i){if(e.isDead()||!e.isLethal())continue;const s=e.getPosition();U({x:t.x,y:t.y},s)<t.mainRadius+e.getRadius()&&(e.kill(),this.addKilledDot())}t.hasAppliedDamage=!0}}update(t,i,e,s){const o=Date.now();this.missiles=this.missiles.filter(n=>n.active),this.explosions=this.explosions.filter(n=>n.active);for(const n of this.explosions)o-n.startTime>=n.duration&&(n.active=!1),n.hasAppliedDamage||this.applyExplosionDamage(n,e);for(const n of this.missiles)if(n.active){if((!n.target||n.target.isDead()||!n.target.isLethal())&&(n.target=this.findBestTarget(n,e)),n.target){const a=n.target.getPosition(),r=Math.atan2(a.y-n.y,a.x-n.x),h=this.normalizeAngle(r-n.angle),c=Math.max(-Y,Math.min(Y,h));n.angle+=c;const p=Math.sqrt(n.vx**2+n.vy**2);n.vx=Math.cos(n.angle)*p,n.vy=Math.sin(n.angle)*p}if(n.x+=n.vx*t,n.y+=n.vy*t,n.x<-b||n.x>s.width+b||n.y<-b||n.y>s.height+b){n.active=!1;continue}for(const a of e){if(a.isDead()||!a.isLethal())continue;const r=a.getPosition();if(U(n,r)<b+a.getRadius()){this.createExplosion(n.x,n.y),n.active=!1;break}}}}render(t){const i=t.getContext(),e=Date.now();for(const s of this.missiles)s.active&&(i.save(),i.translate(s.x,s.y),i.rotate(s.angle),i.beginPath(),i.moveTo(-15,0),i.lineTo(-b,0),i.strokeStyle=Gt,i.lineWidth=4,i.stroke(),i.beginPath(),i.moveTo(b*1.5,0),i.lineTo(-b,-b*.6),i.lineTo(-b,b*.6),i.closePath(),i.fillStyle=kt,i.fill(),i.restore());for(const s of this.explosions){if(!s.active)continue;const o=e-s.startTime,a=1-o/s.duration;if(i.save(),i.globalAlpha=a,i.fillStyle=zt,i.beginPath(),i.arc(s.x,s.y,s.mainRadius,0,Math.PI*2),i.fill(),o>=Wt)for(const r of s.subExplosions)i.beginPath(),i.arc(s.x+r.x,s.y+r.y,r.radius,0,Math.PI*2),i.fill();i.restore()}}isComplete(){return this.missiles.every(t=>!t.active)&&this.explosions.every(t=>!t.active)}}class Xt extends C{type=g.ICE_BOMB;state="EXPLODING";bounds=null;explosionRadius=0;explosionCenter={x:0,y:0};explosionStartTime=0;frozenDotsCount=0;activate(t,i){this.start(),this.explosionStartTime=Date.now(),this.explosionCenter={x:t.position.x,y:t.position.y},this.dots=i,this.explosionRadius=.3*(i.length>0,800),this.freezeDotsInRadius(i),this.state="EXPLODING"}update(t,i,e,s){this.bounds||(this.bounds=s,this.explosionRadius=.3*s.width,this.frozenDotsCount===0&&this.freezeDotsInRadius(this.dots)),this.state==="EXPLODING"?Date.now()-this.explosionStartTime>=500&&(this.state="FADING"):this.state==="FADING"&&Date.now()-this.explosionStartTime>=3e3&&(this.state="COMPLETE")}render(t){if(this.state==="EXPLODING"||this.state==="FADING"){const i=Date.now()-this.explosionStartTime;let e=.6;this.state==="FADING"&&(e=.6*(1-(i-500)/2500)),e>0&&t.drawCircle(this.explosionCenter.x,this.explosionCenter.y,this.explosionRadius,`rgba(0, 204, 255, ${e})`)}}isComplete(){return this.state==="COMPLETE"}freezeDotsInRadius(t){if(!(!t||t.length===0))for(const i of t){if(i.state===E.SPAWNING||i.isDead()||i.isFrozen())continue;const e=i.getPosition(),s=e.x-this.explosionCenter.x,o=e.y-this.explosionCenter.y;Math.sqrt(s*s+o*o)<this.explosionRadius&&(i.freeze(),this.frozenDotsCount++)}}getFrozenDotsCount(){return this.frozenDotsCount}getExplosionRadius(){return this.explosionRadius}}class Vt extends C{type=g.KINETIC_BOMB;state="COLLAPSING";explosionCenter={x:0,y:0};explosionRadius=0;bounds=null;killedDotsInExplosion=new Set;activate(t,i){this.dots=i,this.explosionCenter={x:t.position.x,y:t.position.y},this.start()}update(t,i,e,s){this.bounds||(this.bounds=s);const o=this.getElapsedTime();switch(this.state){case"COLLAPSING":o>=100&&(this.state="EXPLODING",this.explosionRadius=.25*s.width);break;case"EXPLODING":this.killDotsInExplosion(e),o>=1e3&&(this.state="COMPLETE");break}}render(t){const i=this.getElapsedTime();if(this.state==="COLLAPSING"){const e=50*(1-i/100);e>0&&t.drawCircle(this.explosionCenter.x,this.explosionCenter.y,Math.max(0,e),"#FF4500")}else if(this.state==="EXPLODING"){const o=1-(i-100)/900;o>0&&t.drawCircle(this.explosionCenter.x,this.explosionCenter.y,this.explosionRadius,`rgba(255, 69, 0, ${o*.7})`)}}isComplete(){return this.state==="COMPLETE"}killDotsInExplosion(t){for(const i of t){if(i.isDead()||this.killedDotsInExplosion.has(i))continue;const e=i.getPosition(),s=e.x-this.explosionCenter.x,o=e.y-this.explosionCenter.y;Math.sqrt(s*s+o*o)<=this.explosionRadius&&(i.kill(),this.addKilledDot(),this.killedDotsInExplosion.add(i))}}}x.register(y.ZOMBIE_SNOW,xt);x.register(y.SWEEPER_LINE,Tt);x.register(y.SPARSE_GRID,At);x.register(y.BOUNCING_BALL,vt);x.register(y.GATLING_POINT,Ct);x.register(y.BULLET_HELL,Dt);x.register(y.CONTAINMENT_RING,Rt);x.register(y.CYCLONE,Ot);T.register(g.BLASTER,Lt);T.register(g.CHAINSAW,Nt);T.register(g.DOT_REPELLENT,Ft);T.register(g.ELECTRIC_BOMB,_t);T.register(g.FLAME_BURST,Bt);T.register(g.HOMING_MISSILE,Yt);T.register(g.ICE_BOMB,Xt);T.register(g.KINETIC_BOMB,Vt);T.register(g.NUCLEAR_BOMB,Z);R.setupGlobalErrorHandler();new Mt;
//# sourceMappingURL=index-OU0Qonlx.js.map
